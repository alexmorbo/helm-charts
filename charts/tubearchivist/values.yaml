# ==============================================================================
# Global configuration
# ==============================================================================
global:
  # -- Global image registry (used as fallback for all components)
  imageRegistry: ""
  # -- Global deployment strategy (used as fallback for all components)
  strategy:
    type: Recreate
  # -- Global scheduling parameters (used as fallback for all components)
  nodeSelector: {}
  tolerations: []
  affinity: {}

# ==============================================================================
# Main TubeArchivist configuration
# ==============================================================================
image:
  # -- Image registry (falls back to global.imageRegistry, then to docker.io)
  registry: ""
  repository: bbilly1/tubearchivist
  pullPolicy: IfNotPresent
  # -- Overrides the image tag whose default is the chart appVersion.
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# -- Deployment strategy (falls back to global.strategy)
strategy: {}

# -- Environment variables to add to the pods
extraEnv: []
# -- Environment variables from secrets or configmaps to add to the pods
extraEnvFrom: []

serviceAccount:
  create: true
  automount: true
  annotations: {}
  name: ""

podAnnotations: {}
podLabels: {}

podSecurityContext:
  fsGroup: 1000
  fsGroupChangePolicy: OnRootMismatch

securityContext: {}

service:
  type: ClusterIP
  port: 8000
  annotations: {}

ingress:
  enabled: false
  ingressClassName: ""
  annotations: {}
  hosts:
    - host: tubearchivist.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

# -- Gateway API HTTPRoute
route:
  enabled: false
  parentRefs:
    - name: gateway
      namespace: gateway-system
  hostnames:
    - tubearchivist.local
  annotations: {}
  labels: {}

resources: {}

# -- Additional volumes (e.g., NFS for media storage)
# Example NFS volume for media:
# volumes:
#   - name: media
#     nfs:
#       server: "nas.example.com"
#       path: "/volume1/youtube"
#       readOnly: false
volumes: []

# -- Additional volume mounts
# Example NFS mount for media (use instead of persistence.media):
# volumeMounts:
#   - name: media
#     mountPath: /youtube
volumeMounts: []

nodeSelector: {}
tolerations: []
affinity: {}

startupProbe:
  httpGet:
    path: /api/health/
    port: http
    httpHeaders:
      - name: Host
        value: localhost
  initialDelaySeconds: 30
  periodSeconds: 10
  failureThreshold: 30

livenessProbe:
  httpGet:
    path: /api/health/
    port: http
    httpHeaders:
      - name: Host
        value: localhost
  periodSeconds: 120
  timeoutSeconds: 10

readinessProbe:
  httpGet:
    path: /api/health/
    port: http
    httpHeaders:
      - name: Host
        value: localhost
  periodSeconds: 30
  timeoutSeconds: 10

# ==============================================================================
# Persistence configuration (separate PVCs for media and cache)
# ==============================================================================
persistence:
  # -- Media storage for downloaded videos
  # NOTE: Set enabled=false if using NFS via volumes/volumeMounts
  media:
    enabled: true
    size: 100Gi
    storageClass: ""
    accessModes:
      - ReadWriteOnce
    existingClaim: ""
    annotations: {}
  # -- Cache storage for thumbnails and temporary files
  cache:
    enabled: true
    size: 10Gi
    storageClass: ""
    accessModes:
      - ReadWriteOnce
    existingClaim: ""
    annotations: {}

# ==============================================================================
# Application configuration
# ==============================================================================
app:
  # -- Required: Server URL with protocol and port (e.g., http://tubearchivist.local:8000)
  host: ""

  # -- Timezone (e.g., Europe/Moscow, UTC)
  timezone: "UTC"

  # -- Initial admin credentials (only used on first startup)
  admin:
    username: "admin"
    password: ""
    existingSecret: ""
    existingSecretUsernameKey: "username"
    existingSecretPasswordKey: "password"

  # -- yt-dlp auto-update: "" (disabled), "release", or "nightly"
  ytdlpAutoUpdate: ""

  # -- Authentication mode: local, ldap, forwardauth, ldap_local
  authMode: "local"

  # -- LDAP configuration
  ldap:
    enabled: false
    # -- LDAP server URI (ldap://server:389 or ldaps://server:636)
    serverUri: ""
    bindDn: ""
    bindPassword: ""
    existingSecret: ""
    existingSecretBindPasswordKey: "bind-password"
    # -- Disable certificate verification for LDAPS
    disableCertCheck: false
    userBase: ""
    userFilter: "(objectClass=user)"
    # -- Attribute mapping
    attrMap:
      username: "uid"
      personalName: "givenName"
      surname: "sn"
      email: "mail"
    # -- Comma-separated usernames to promote to superuser
    promoteToSuperuser: ""
    # -- Comma-separated usernames to promote to staff
    promoteToStaff: ""

  # -- Forward auth (reverse proxy authentication)
  forwardAuth:
    enabled: false
    usernameHeader: "HTTP_REMOTE_USER"
    logoutUrl: ""

  # -- File ownership UID
  hostUid: 1000
  # -- File ownership GID
  hostGid: 1000

  # -- Disable static file authentication (for reverse proxy setups)
  disableStaticAuth: false
  # -- Enable Django debug mode
  djangoDebug: false

  # -- Built-in Valkey (Redis-compatible)
  valkey:
    enabled: true
    # -- Prefix for Redis keys
    prefix: ""

  # -- External Redis/Valkey (when app.valkey.enabled=false)
  valkeyExternal:
    url: ""
    existingSecret: ""
    existingSecretKey: "url"

  # -- Built-in Elasticsearch
  elasticsearch:
    enabled: true
    image:
      # -- Registry (falls back to global.imageRegistry, then to docker.io)
      registry: ""
      repository: bbilly1/tubearchivist-es
      pullPolicy: IfNotPresent
      tag: "8.19.0"
    replicas: 1
    # -- Elasticsearch password (auto-generated if empty)
    password: ""
    existingSecret: ""
    existingSecretPasswordKey: "password"
    # -- Java heap options
    javaOpts: "-Xms512m -Xmx512m"
    resources: {}
    # -- Extra environment variables for Elasticsearch
    extraEnv: []
    persistence:
      enabled: true
      size: 30Gi
      storageClass: ""
      accessModes:
        - ReadWriteOnce
      existingClaim: ""
      annotations: {}
    nodeSelector: {}
    tolerations: []
    affinity: {}

  # -- External Elasticsearch (when app.elasticsearch.enabled=false)
  elasticsearchExternal:
    url: ""
    username: "elastic"
    password: ""
    existingSecret: ""
    existingSecretPasswordKey: "password"
    # -- Disable SSL certificate verification
    disableVerifySsl: false

# ==============================================================================
# Valkey subchart configuration
# See https://github.com/valkey-io/valkey-helm for all options
# ==============================================================================
valkey:
  enabled: true
  architecture: standalone
  auth:
    enabled: false
  primary:
    persistence:
      enabled: true
      size: 1Gi

# ==============================================================================
# Monitoring configuration
# ==============================================================================
monitoring:
  enabled: false
  # -- Type of service monitor: ServiceMonitor (Prometheus) or VMServiceScrape (VictoriaMetrics)
  type: ServiceMonitor
  path: /api/health/
  interval: 60s
  scrapeTimeout: 10s
  labels: {}
  namespace: ""
