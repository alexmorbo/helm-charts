{{- $createDbSecret := and .Values.app.database.password (not .Values.app.database.existingSecret) }}
{{- $createValkeySecret := and (not .Values.app.valkey.enabled) .Values.app.valkeyExternal.url (not .Values.app.valkeyExternal.existingSecret) }}
{{- $createOidcSecret := and .Values.app.oidc.enabled .Values.app.oidc.clientId .Values.app.oidc.clientSecret (not .Values.app.oidc.existingSecret) }}
{{- if or $createDbSecret $createValkeySecret $createOidcSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "paperless-ngx.fullname" . }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "paperless-ngx.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if $createDbSecret }}
  db-password: {{ .Values.app.database.password | b64enc | quote }}
  {{- end }}
  {{- if $createValkeySecret }}
  valkey-url: {{ .Values.app.valkeyExternal.url | b64enc | quote }}
  {{- end }}
  {{- if $createOidcSecret }}
  oidc-client-id: {{ .Values.app.oidc.clientId | b64enc | quote }}
  oidc-client-secret: {{ .Values.app.oidc.clientSecret | b64enc | quote }}
  {{- end }}
{{- end }}
